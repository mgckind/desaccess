<dom-module id="des-login-signup">
<template>
  <style include="shared-styles">
  </style>


<iron-ajax id="SignupForm"
    url="/easyweb/signup/"
    method="POST"
    handle-as="json"
    content-type="application/x-www-form-urlencoded"
    on-response="afterForm"
    debounce-duration="300">
</iron-ajax>


<paper-dialog class="tos-dialog" id="TermsDialog" modal>
  <h2>Terms and Conditions</h2>

             <p>
               <span style="color: rgb(33,33,33);">Welcome to the DESaccess website.<br/>
               </span>
               <span style="color: rgb(33,33,33);">NCSA provides these website applications and other products and services to access DES public data.By using these services and  data products you  agree to abide by these terms.<br/>
               </span>
               <span style="color: rgb(33,33,33);">NCSA provides these services and access to DES data, subject to the following policies and agreements, conditions, and licenses.<br/>
               </span>
             </p>
             <p>
               <span style="color: rgb(33,33,33);">These Terms are subject to review and modification without user notifice. Revisions and changes will be published on this page.<br/>
               </span>
             </p>
             <p>
               <span style="color: rgb(33,33,33);">For more information regarding these terms, please contact us at </span>
               <a href="mailto:des-dr-help@ncsa.illinois.edu">
                 <span style="color: rgb(17,85,204);">des-dr-help@ncsa.illinois.edu</span>
               </a>
               <span style="color: rgb(255,0,0);">.</span>
             </p>
             <h3>
               <u>
                 <span style="color: rgb(67,67,67);">Services</span>
               </u>
             </h3>
             <p>
               <span style="color: rgb(0,0,0);">Registered users agree that as a result of registering for these services they will receive maintenance, administrative, and general announcements by email.</span>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">Registered users acknowledge that NCSA provideS these services “as is”. We are a small team and we are trying to provide an enjoyable and seamless user experience when accessing DES data. NCSA does not make any specific promises about these services except to  do the best possible to accomplish our goal. </span>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">To provide registered users with a fair and homogeneous experience, service  limitations are detailed in each application’s documentation. These limitations include CPU time for long queries and memory resources for performing cutouts for many locations at once, among others. NCSA retains the right to stop any process or jobs that  is consuming more resources than expected.</span>
             </p>
             <h3>
               <u>
                 <span style="color: rgb(67,67,67);">Data Policy</span>
               </u>
             </h3>
             <p>
               <span style="color: rgb(0,0,0);">Registered users who make use of these data (catalogs, files or images) for research, teaching purposes, and other activities may freely use these products under the condition to abide by the License below.</span>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">Commercial use of these data is strictly prohibited without permission.</span>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">If in doubt about this Data Policy or how it applies in your case, please do not hesitate to contact us.</span>
             </p>
             <h3>
               <u>
                 <span style="color: rgb(67,67,67);">Acceptable Use Policy</span>
               </u>
             </h3>
             <p>
               <span style="color: rgb(0,0,0);">Registered users agree to use these services, including the web pages, the web applications, and the file servers, for their intended purpose and to not  cause harm or perform actions that significantly impede, in the judgment of service managers, other users from full use of these services. </span>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">Registered users agree to use only authorized access methods, to access only  authorized data, and to not perform any unauthorized changes to the documentation or to our services.</span>
             </p>
             <p>
               <span style="color: rgb(33,33,33);">Termination: NCSA retains the right to terminate or interrupt the usage of these services if a registered user violates the Acceptable Use Policy.</span>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">Data Expiration: User-generated data, including internal database tables, files as result of databases queries, and cutout files, will be stored for a limited period of time, between 7 and 10 days, under normal conditions.</span>
             </p>
             <h3>
               <u>
                 <span style="color: rgb(67,67,67);">License</span>
               </u>
             </h3>
             <p>
               <span style="color: rgb(0,0,0);">Registered users agree that the data obtained  from this site may be used for any purpose, provided the Citation and Acknowledgement Policy is applied to any publication or other public dissemination of the data which is  obtained by registered users from the site or to any data derived from data obtained from the site.</span>
             </p>
             <h3>
               <u>
                 <span style="color: rgb(67,67,67);">Citation, Copyright and  Acknowledgement Policy</span>
               </u>
             </h3>
             <p>
               <span style="color: rgb(34,34,34);">Registered users  are requested to credit and acknowledge the DES Collaboration when using any and all material from these services.</span>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">For citations in academic format cite:</span>
             </p>
             <ul>
               <li style="list-style-type: disc;">
                 <p>
                   <span>The Dark Energy Survey Data Release 1, DES Collaboration (2018)</span>
                 </p>
               </li>
               <li style="list-style-type: disc;">
                 <p>
                   <span>The Dark Energy Survey Image Processing Pipeline, E. Morganson, et al. (2018)</span>
                 </p>
               </li>
               <li style="list-style-type: disc;">
                 <p>
                   <span style="color: rgb(65,105,225);">
                     <a href="http://adsabs.harvard.edu/abs/2015AJ....150..150F">The Dark Energy Camera, B. Flaugher, et al, AJ, 150, 150 (2015)</a>
                   </span>
                 </p>
               </li>
             </ul>
             <p>
               <span style="color: rgb(0,0,0);">
                 <br/>For other works credit:</span>
             </p>
             <ul>
               <li style="list-style-type: disc;">
                 <p>
                   <span>
                     <em>“The Dark Energy Survey Data Release 1"</em>
                     <br/>
                   </span>
                 </p>
               </li>
             </ul>
             <p>
               <span style="color: rgb(0,0,0);">Registered users are requested to include the respective acknowledgments in any publication that uses DES data. Please reference the Acknowledgements page: </span>
             </p>
             <p>
               <a href="https://des.ncsa.illinois.edu/thanks">
                 <span style="color: rgb(17,85,204);">https://des.ncsa.illinois.edu/thanks</span>
               </a>
             </p>
             <p>
               <a href="https://des.ncsa.illinois.edu/thanks">
                 <span style="color: rgb(17,85,204);">
                   <br/>
                 </span>
               </a>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">If NCSA services are used in any scientific or educational work, we suggest the following acknowledgment:</span>
             </p>
             <p>
               <em>
                 <span style="color: rgb(0,0,0);">This work has made use of  NCSA resources and services.</span>
               </em>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">Registered users are asked to notify the DES Release Team (</span>
               <a href="mailto:des-dr-help@ncsa.illinois.edu">
                 <span style="color: rgb(17,85,204);">des-dr-help@ncsa.illinois.edu</span>
               </a>
               <span style="color: rgb(0,0,0);">) upon any acceptance or publication of an article, poster, or educational work which is based on DES data.</span>
             </p>
             <h3>
               <u>
                 <span style="color: rgb(67,67,67);">Privacy Policy</span>
               </u>
             </h3>
             <p>
               <span style="color: rgb(0,0,0);">Information collected during registration (such as Name, Last Name, and Email) and usage of these services, such accessing logs and job statistics, is used solely for the management of the services provided.  However, information you disclose, including email addresses, when using supporting fora may be available in other  supporting fora. An example of a supporting fora is an online help discussion.</span>
             </p>
             <p>
               <span style="color: rgb(0,0,0);">Your username may be visible to other users of the system, for example, visible in your status and other operational meta-data.   </span>
             </p>
             <p>
               <br/>
             </p>



    <div class="buttons">
  <paper-button class="custom indigo" dialog-confirm >Close</paper-button>

</div>
</paper-dialog>

    <template is="dom-if" if="{{msg}}">
        <des-login-message title='Thanks!'>
            <b> Activation Required:</b> {{text}} <br /> <br />
            Please check your email and use the activation link provided.<br /><br />
        </des-login-message>
    </template>

    <template is="dom-if" if="{{!msg}}">


  <div style="cursor:default;" class="container">
    <!-- https://elements.polymer-project.org/guides/flex-layout -->
    <paper-card style="cursor:default;" heading="Registration form" class="temp">

      <div style="cursor:default;" class="box-watermark-logo"></div>

      <div class="card-content">

        <span>Please complete and submit this form. <br />

        <span> Fill this <a href='http://des.ncsa.illinois.edu/help' target="_blank">form</a>
             if you have trouble accessing the server</span><br /><br />
            You need to read and accept the <a href="javascript:;" on-click="_readT">Terms and Conditions</a> to continue.</span><br>

         <iron-form id="signUser">
         <form action="/easyweb/signup/" method="post">
          <div class="container2">
          <paper-input id="form_first" name="firstname" label="First" ></paper-input> &nbsp; &nbsp;
          <paper-input id="form_last" name="lastname" label="Last" ></paper-input>
          </div>
          <paper-input id="form_email" name="email" label="Email" on-change="_enable" required auto-validate></paper-input><br>
          <paper-input  id="form_user" name="username" label="Username" on-change="_enable" required auto-validate pattern="[a-zA-Z0-9]*" char-counter minlength="3" error-message="Minimum length is 3. Include alphanumeric characters only" ></paper-input><br>

          <match-passwords-validator id="match-passwords-validator"
            password="[[password]]">
          </match-passwords-validator>
          <paper-password-input id="first_password" label="Password (Minimum 6 characters, alphanumeric only)"
            value="{{password}}"
            char-counter
             required>
          </paper-password-input>
          <paper-password-input id="form_password" on-invalid-changed="_enable" id="NewPass" name="password" label="Confirm Password"
            auto-validate
            validator="match-passwords-validator"
            error-message="Passwords need to match"
            required>
          </paper-password-input>
          <br>
          <paper-checkbox id="readTerms" name="read" on-change="_enable" required>I agree to the </paper-checkbox> <a href="javascript:;" on-click="_readT">Terms and Conditions</a><br>
          <div class="container">
            <paper-button class="custom indigo" id="SignButton"
            on-tap="_clickSubmit" raised disabled>
              Submit
            </paper-button>
            <paper-spinner  id="LoginSpinnerSignup" class="big"></paper-spinner>
          </div>

        </form>
        </iron-form>

        <div id="divError2" class="errormessage">
          <b>{{error}}</b>
        </div>
      </div>

      <div  style="cursor:pointer;" on-tap="home" class="box-upper-image"></div> <!-- TODO: ADD link to home page to the box -->


    </paper-card>
  </div>
    </template>
<paper-toast class="toast-position" id="toastSignUp" text="Form Submitted!" duration="2000"> </paper-toast>
<paper-toast class="toast-position" id="toastSignUpError" text="ERROR: Check your form" duration="2000"> </paper-toast>
</template>

<script>
  Polymer({
    is: "des-login-signup",

    behaviors: [
      Polymer.IronA11yKeysBehavior
    ],

    properties : {
      error :{
        type: String,
        value: '',
      },
      errno :{
        type: String,
        value: '',
      },
      text :{
        type: String,
        value: '',
      },
      msg:{
        type: Boolean,
        value: false,
      },
      toastpass: {
        type: String,
        value: false,
        //observer: "_updateToast"
    },
    },

    keyBindings:{
      'enter:keydown':'_clickSubmit',
    },

    _readT: function(){
            termd = document.getElementById('TermsDialog');
            termd.open();
    },
      _enable: function(e){
          //this.msg = true;
          var form = document.getElementById('signUser');
          var valid_form = form.validate();
          var invalid = true;
          var button = document.getElementById('SignButton');
          if (valid_form) {
              button.disabled = false;
                }
            else button.disabled = true;
           },
    _clickSubmit: function(e) {
      var button = document.getElementById('SignButton');
      var form2 = document.getElementById('SignupForm');
      form2.body = {
          'username': document.getElementById('form_user').value,
          'firstname': document.getElementById('form_first').value,
          'lastname': document.getElementById('form_last').value,
          'password': document.getElementById('form_password').value,
          'email': document.getElementById('form_email').value,
      };
      var form = document.getElementById('signUser');
      var valid_form = form.validate();
      if (valid_form) {
        button.disabled = true;
        document.getElementById('LoginSpinnerSignup').active = true;
        form2.generateRequest();
       }
    },
    afterForm: function(e){

     var _self = this;
     _self.data = e.detail.response;
     document.getElementById('readTerms').checked= false;
     this._enable();
     document.getElementById('LoginSpinnerSignup').active = false;
     //document.getElementById("toastSignUp").show();
     this.error = _self.data.msg;
     this.errno = _self.data.errno;
     console.log(this.error);
     if (this.errno=='1') {
         document.getElementById('form_user').value = '';
         document.getElementById("toastSignUpError").show();
     }
     else if (this.errno=='2') {
         document.getElementById('form_email').value = '';
         document.getElementById("toastSignUpError").show();
     }
     else if (this.errno=='3') {
         document.getElementById('form_password').value = '';
         document.getElementById("toastSignUpError").show();
     }
     else {
         document.getElementById("toastSignUp").show();
         var email = document.getElementById('form_email').value;
         this.text = 'An activation link was sent to '+ email + '.';
         this.msg=  true;
         //msgReq = document.getElementById('Message');
         //msgReq.body = {
          //'title': 'Activation link sent by email',
         //};
        //msgReq.generateRequest();
      }

    },
    _updateToast: function(e) {
      if (this.toastpass=='yes'){
        document.getElementById("toastSignUp").show();
      }
  },
      home: function(event){
        window.open('/easyweb/','_self',false);
      },

  });


</script>
</dom-module>
