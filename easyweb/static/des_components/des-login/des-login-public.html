<dom-module id="des-login-public">
<template>
  <style include="shared-styles">
  </style>

  <paper-dialog class="fixbox" id="updateDialog" modal>
    <des-login-update error="{{error}}" db="{{db}}"></des-login-update>
  </paper-dialog>



  <div style="cursor:default;" class="container">
      <div class="fixbox">
    <!-- https://elements.polymer-project.org/guides/flex-layout -->
    <paper-card style="cursor:default;" heading="The content of these pages are restricted."
    class="temp">

      <div style="cursor:default;" class="box-watermark-logo"></div>
      <div class="card-content">
        <span>Use your Internal DES DB credentials. <br />
        <span> Fill this <a href='https://deslogin.wufoo.com/forms/help-me-with-my-desdm-account/' target="_blank">form</a>
             if you have trouble accessing the server</span>

        <form id="userpass" action="/easyweb/login/" method="post">
          <input type="hidden" id="hiddenDB" name="database" value="test">
          <input type="hidden" id="hiddenNext" name="next" value="test">
          <paper-input name="username" label="Username"
          required></paper-input><br>
          <paper-password-input name="password" label="Password"
            value="{{password}}" required></paper-password-input>

          <br>
          <div class="container">
            <paper-button class="custom indigo" id="LoginButton1"
            on-tap="_clickSubmit1" raised>
              dessci
            </paper-button>
            <paper-button class="custom indigo" id="LoginButton2"
            on-tap="_clickSubmit2" raised>
              desoper
            </paper-button>
            <paper-spinner  id="LoginSpinner1" class="big"></paper-spinner>
          </div>

          <div >
          </div>
        </form>

        <div id="divError" class="errormessage">
          <b>{{error}}</b>
          <br />
        </div>
            <a href="https://deslogin.wufoo.com/forms/help-me-with-my-desdm-account/" style="font-size: 11px; margin-left: 5px;"> Forgot Password? </a>
      </div>

      <div  style="cursor:pointer;" on-tap="home" class="box-upper-image"></div> <!-- TODO: ADD link to home page to the box -->

    </paper-card>
      </div>
  </div>
</template>

<script>
  Polymer({
    is: "des-login-public",

    behaviors: [
      Polymer.IronA11yKeysBehavior
    ],

    properties : {
      error :{
        type: String,
        value: '',
      },
      error2 :{
        type: String,
        value: '',
      },
      next :{
        type: String,
        value: '',
      },
      update:{
        type: String,
        value: false,
        observer: '_updatePass'

      },
      toastpass: {
        type: String,
        value: false,
        observer: "_updateToast"
    },
      db: {
        type: String,
        value: '',
      }
    },

    keyBindings:{
      'enter:keydown':'_clickSubmit1',
    },

    afterResetForm: function(e){
     var _self = this;
     _self.data = e.detail.response;
      document.getElementById('ResetSpinner').active = false;
     if (_self.data.errno == '0'){
          document.getElementById('toastPass').show();
          document.getElementById('resetDialog').close();
          document.getElementById('ResetFormButton').disabled = false;
             }
      else {
          this.error2 = _self.data.msg;
           document.getElementById('ResetFormButton').disabled = false;
      }
     //document.getElementById('LoginSpinner').active = false;
     //document.getElementById("toastSignUp").show();
    },

    _clickSubmit1: function(e) {
      document.getElementById('hiddenDB').value = 'dessci';
      document.getElementById('hiddenNext').value = this.next;
      var button1 = document.getElementById('LoginButton1');
      var button2 = document.getElementById('LoginButton2');
      document.getElementById('LoginSpinner1').active = true;
      document.getElementById('userpass').submit();
      button1.disabled = true;
      button2.disabled = true;
      var errm = document.getElementById('divError');
      errm.style.display = "none";
    },
    _clickSubmit2: function(e) {
      document.getElementById('hiddenDB').value = 'desoper';
      document.getElementById('hiddenNext').value = this.next;
      var button1 = document.getElementById('LoginButton1');
      var button2 = document.getElementById('LoginButton2');
      document.getElementById('LoginSpinner1').active = true;
      document.getElementById('userpass').submit();
      button1.disabled = true;
      button2.disabled = true;
      var errm = document.getElementById('divError');
      errm.style.display = "none";
    },

    _updatePass: function(e) {
      if (this.update=='yes') {
        document.getElementById("updateDialog").open();
      }
    },

    _updateToast: function(e) {
      if (this.toastpass=='yes'){
        console.log('password changed');
        document.getElementById("toastPass").show();
      }
  },
      home: function(event){
        window.open('/easyweb/','_self',false);
      },

  });


</script>
</dom-module>
