<dom-module id="des-data-analysis">
    <style include="shared-styles">
        .caption {
            padding-left: 15px;
            color: #a0a0a0;
        }
        .upload{
            position: absolute;
            opacity: 0;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            /*border: 2px dotted #8da6ce;*/
            /*border-style: outset;*/
        }

        .card-content {
            @apply(--layout-vertical);
        }

        /*.middle {*/
        /*@apply(--layout-flex);*/
        /*}*/

        .coadd-container {
            margin-top: 10px;
            @apply(--layout-horizontal);
        }

        .container2 {
            @apply(--layout-horizontal);
            @apply(--layout-center-justified);
        }
        .container3 {
            @apply(--layout-horizontal);
            @apply(--layout-around-justified);
        }

        .left {
            @apply(--layout-flex);
        }
        .left2 {
            @apply(--layout-flex);
            text-align: center;

        }
        .right {
            @apply(--layout-flex);

        }

        .right2 {
            @apply(--layout-flex-2);
            text-align: center;

        }

        .mid {
            @apply(--layout-flex);
        }
        .flex3child {
            @apply(--layout-flex-3);
        }
        .flex4child {
            @apply(--layout-flex-4);
        }

        paper-slider {
            width: 100%;
        }

        hr {
            display: block;
            border: 1px solid gray;
            opacity: 0.2;

        }

        paper-icon-item {
            /*background: linear-gradient(to right, #efeaf4, white);*/
        }

        .buttonLook{
            border: 4px solid #ccc;
            border-style: outset;
            border-radius: 10px;
        }



        .btcell {
            text-align: center;
        }

        .around-cell {
            @apply(--layout-horizontal);
            @apply(--layout-around-justified);
        }


    </style>
    <template>
        <paper-dialog class="dialog-position" id="jobHelpDataAnalysis" with-backdrop on-iron-overlay-opened="patchOverlay" style="max-width: 1000px; max-height: 800px;">
            <des-card heading="Help: Data Analysis Form">
                <div class="card-content">
                    <paper-carousel id="da-coadd-crs" items="1" dotText="false" controls="true">
                        <div class="carousel-item">
                            <p>This form generates several useful plots.</p>
                            <p>The <span style="font-weight:bold;">Flux vs. Wavelength</span> and <span style="font-weight:bold;">Magnitude vs. Wavelength</span> options combine DES data with WISE and VHS data to create non-continuous SED plots. However, both WISE and VHS footprints do not fully overlap the DES footprint, and if your object is not covered by either or both these surveys then the plot will still be created, but with only the data that exists.</p>
                            <p>The <span style="font-weight:bold;">G-R vs. R-I</span> plot is a color-color contour plot based on the stellar main sequence stars. From the <span style="font-style:italic;">g, r, i</span> colors of your object, the plot will make a guess as to which type of star it could be. Your object is displayed with color magnitude errors.</p>
                            <p>The <span style="font-weight:bold;">G-Z vs. Z-W1</span> plot combines DES and WISE data and plots your object against a large sample of DES objects divided by quasars, galaxies, and stars. From the <span style="font-style:italic;">g, z, w1</span> colors of your object, the plot will show a guess as to which type your object might be. Color magnitude errors are plotted with your object. Because the WISE footprint does not fully overlap the DES footprint, it's possible your object won't have WISE data. In this case the plot cannot be created. Your object is displayed with color magnitude errors.</p>
                            <p>The <span style="font-weight:bold;">Spread vs. Magnitude</span> plots your object against a large sample of DES objects divided by extended and pointlike spread in the i band. From these values for your object, a guess between pointlike and extended is made.</p>
                        </div>
                        <div class="carousel-item">
                            <p>You can upload a CSV file with either Coadd IDs or RA/DEC pairs or you can enter a list of either manually.</p>
                            <div>
                                <p><span style="font-weight:bold;">Upload File:</span> If you upload a CSV, you must include the columns headers "COADD_OBJECT_ID" or "RA,DEC" (without quotation marks). Example is shown at right.</p>
                                <img src="/easyweb/static/images/coaddid_column_header.png" style="width:200px; float: right; border: 1px #000 solid; margin:5px;" />
                                <img src="/easyweb/static/images/position_column_headers.png" style="width: 200px; float: right; border: 1px #000 solid; margin:5px;" />
                            </div>
                            <div style="clear:right;">
                                <p><span style="font-weight:bold;">Enter Values:</span> You can enter a list of Coadd IDs or RA/DEC pairs manually. You do not need to include the column headers here.</p>
                                <img src="/easyweb/static/images/manual_coadds.png" style="width: 300px; float: right; border: 1px #000 solid; margin:5px;" />
                                <img src="/easyweb/static/images/manual_positions.png" style="width: 300px; float: right; border: 1px #000 solid; margin:5px;" />
                            </div>
                        </div>
                        <div class="carousel-item">
                            <p><span style="font-weight:bold;">Search Box:</span> The search box option allows you to set the radius (in arcseconds) to search for your object when using RA/DEC coordinates instead of Coadd IDs.</p>
                            
                            <p><span style="font-weight:bold;">Job Name:</span> The Job Name is for your records and does not affect the completion of the job.</p>
                            
                            <p><span style="font-weight:bold;">Email Options:</span> If you wish, the server can send an email notification when the job is completed. Check "Send email on completion" and verify the email you wish the notification to be sent to.</p>
                        </div>
                        <div class="carousel-item">
                            <div style="text-align: left;"><p>Example Flux vs. Wavelength:</p></div>
                            
                        </div>
                        <div class="carousel-item">
                            <div style="text-align: left;"><p>Example Magnitude vs. Wavelength:</p></div>
                            
                        </div>
                        <div class="carousel-item">
                            <div style="text-align: left;"><p>Example G-R vs. R-I:</p></div>
                            
                        </div>
                        <div class="carousel-item">
                            <div style="text-align: left;"><p>Example G-Z vs. Z-W1:</p></div>
                            
                        </div>
                        <div class="carousel-item">
                            <div style="text-align: left;"><p>Example Spread vs. Magnitude:</p></div>
                            
                        </div>
                    </paper-carousel>
                </div>
                <div class="row">
                    <paper-button class="prev" on-tap="_prevPage"><iron-icon icon="image:navigate-before"></iron-icon>Prev</paper-button>
                    <paper-button class="next" on-tap="_nextPage">Next<iron-icon icon="image:navigate-next"></iron-icon></paper-button>
                </div>
                <div class="row">
                    <paper-button class="indigo" on-tap="_gobackdialog" raised focused>Close</paper-button>
                </div>
            </des-card>
        </paper-dialog>
        <section>
            <des-card heading="Data Analysis Form">
                <div class="card-content">
                    <div class="top">
                        Upload the file with the positions or enter the positions by hand and run the plot generator
                    </div>

                    <!-- table -->
                    <table id="coadd-table" style="width:100%">
                        <tr class="coadd-tr">
                            <td class="coadd-td">
                                <paper-icon-item>
                                    <iron-icon icon="backup" slot="item-icon"></iron-icon>
                                    <span style="overflow-x: auto; overflow-wrap: break-word;">
                                    Upload File (csv, with COADDID or RA,DEC as uncommented header)
                                    </span>
                                    <!--<input type="file" class="upload" id="file" on-change="_fileChange"/>-->
                                </paper-icon-item>
                            </td>
                            <td class="btcell">
								<div class="around-cell">
	                                <paper-button raised class="indigo" id="da_uploadFileCoadd">
	                                    <div id="da_uploadiconcoadd" style="display: inline-block;">
	                                        <i class="fa fa-cloud-upload"></i>
	                                        &nbsp;  &nbsp;
	                                        Coadd ID: &nbsp;
	                                    </div>
	                                    <span style="overflow-x: auto; overflow-wrap: break-word;">
											[[file_name]]
										</span>
	                                    <input type="file" class="upload" id="file1" on-change="_fileChange1" />
	                                </paper-button>
	                                <paper-button raised class="indigo" id="da_uploadFileCoord">
	                                    <div id="da_uploadiconcoord" style="display: inline-block;">
	                                        <i class="fa fa-cloud-upload"></i>
	                                        &nbsp;  &nbsp;
	                                        RA/DEC: &nbsp;
	                                    </div>
	                                    <span style="overflow-x: auto; overflow-wrap: break-word;">
											[[file_name]]
										</span>
	                                    <input type="file" class="upload" id="file2" on-change="_fileChange2" />
	                                </paper-button>
                                </div>
                            </td>
                        </tr>
                        <tr class="coadd-tr">
                            <td class="coadd-td">
                                <paper-icon-item>
                                    <iron-icon icon="hardware:keyboard" slot="item-icon"></iron-icon>
                                    Enter Values for COADD or RA/DEC
                                </paper-icon-item>
                            </td>
                            <td class="btcell">
                                <div class="around-cell">
									<paper-button raised class="indigo" id="da_enterCoadds" on-tap="_da_openCoadds">
	                                    <div id ="da_keyboardiconcoadd" style="display: inline-block;"> <i class="fa fa-keyboard-o"></i>
	                                        &nbsp;  &nbsp;
	                                        Coadd ID: &nbsp;
	                                    </div>
	                                    <span>[[enter_values]]</span>
	                                </paper-button>
									<paper-button raised class="indigo" id="da_enterCoords" on-tap="_da_openCoords">
	                                    <div id ="da_keyboardiconcoord" style="display: inline-block;"> <i class="fa fa-keyboard-o"></i>
	                                        &nbsp;  &nbsp;
	                                        RA/DEC: &nbsp;
	                                    </div>
	                                    <span>[[enter_values]]</span>
	                                </paper-button>
								</div>
                            </td>
                        </tr>
                        <!--<tr class="coadd-tr">
                            <td class="coadd-td">
                                <paper-icon-item>
                                    <iron-icon icon="image:tune" slot="item-icon"></iron-icon>
                                    <div>Xsize (in arcminutes):
                                        <span id="da_xsizeLabel" class="caption">1.0</span></div>
                                </paper-icon-item>
                            </td>
                            <td class="coadd-td">
                                <paper-slider id="da_xsizeSlider" pin max="12" max-markers="10" step="0.1" value="1.0" expand editable></paper-slider>
                            </td>
                        </tr>
                        <tr class="coadd-tr">
                            <td class="coadd-td">
                                <paper-icon-item>
                                    <iron-icon icon="image:tune" slot="item-icon"></iron-icon>
                                    <div>Ysize (in arcminutes):
                                        <span id="da_ysizeLabel" class="caption">1.0</span></div>
                                </paper-icon-item>
                            </td>
                            <td class="coadd-td">
                                <paper-slider id="da_ysizeSlider" pin  max="12" max-markers="10" step="0.1" value="1.0" expand editable></paper-slider>
                            </td>
                        </tr>-->
                        <tr class="coadd-tr">
							<td class="coadd-td">
								<paper-icon-item>
									<iron-icon item="image:tune" slot="item-icon"></iron-icon>
									<div>Search Box (in arcseconds):
										<span id="da_radiusLabel" class="caption">4.0</span>
									</div>
								</paper-icon-item>
							</td>
							<td class="coadd-td">
								<paper-slider id="da_radiusSlider" pin  min="1" max="20" min-marker="1" max-marker="20" step="1.0" value="4.0" expand editable></paper-slider>
							</td>
                        </tr>
                        <tr class="coadd-tr">
							<td class="coadd-td">
								<paper-icon-item>
									<iron-icon icon="image:tune" slot="item-icon"></iron-icon>
									Include Surveys (DES only by default)
								</paper-icon-item>
							</td>
							<td class="coadd-td">
								<div class="around-cell">
									<!--<paper-checkbox checked style="font-size:16px; padding-top:15px;" id="da_des">DES</paper-checkbox>-->
									<paper-checkbox style="font-size:16px; padding-top:15px;" id="da_wise">WISE</paper-checkbox>
									<paper-checkbox style="font-size:16px; padding-top:15px;" id="da_vhs">VHS</paper-checkbox>
								</div>
							</td>
                        </tr>
                        <tr class="coadd-tr">
							<td class="coadd-td">
								<paper-icon-item>
									<iron-icon icon="image:tune" slot="item-icon"></iron-icon>
									Plot Options
								</paper-icon-item>
							</td>
                            <td class="coadd-id">
                                <div class="around-cell">
                                    <div class="left">
                                        <div class="around-cell" style="float: left;">
                                            <paper-checkbox style="font-size:16px; padding-top:15px;" id="da_fluxwav">Flux vs. Wavelength</paper-checkbox>
                                        </div>
                                        <div class="around-cell" style="float: left; clear: left;">
                                            <paper-checkbox style="font-size:16px; padding-top:15px;" id="da_magwav">Magnitude vs. Wavelength</paper-checkbox>
                                        </div>
                                        <div class="around-cell" style="float: left; clear: left;">
                                            <paper-checkbox style="font-size:16px; padding-top:15px;" id="da_grri">G-R vs. R-I</paper-checkbox>
                                        </div>
                                        <div class="around-cell" style="float: left; clear: left;">
                                            <paper-checkbox style="font-size:16px; padding-top:15px;" id="da_gzzw1">G-Z vs. Z-W1 (Uses WISE data)</paper-checkbox>
                                        </div>
                                        <div class="around-cell" style="float: left; clear: left;">
                                            <paper-checkbox style="font-size:16px; padding-top:15px;" id="da_spreadmag">Spread vs. Magnitude</paper-checkbox>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr class="coadd-tr">
                            <td class="coadd-td">
                                <paper-icon-item>
                                    <iron-icon icon="create" slot="item-icon"></iron-icon>
                                    Job Name
                                </paper-icon-item>
                            </td>
                            <td class="coadd-td">
                                <paper-input always-float-label id="da_validname" name="name" label="Job Name" value="" style = "max-width: 500px;"></paper-input>
                            </td>
                        </tr>
                        <tr class="coadd-tr">
                            <td class="coadd-td">
                                <paper-icon-item>
                                    <iron-icon icon="mail" slot="item-icon"></iron-icon>
                                    Email Options
                                </paper-icon-item>
                            </td>
                            <td class="coadd-td">
                                <div class="around-cell">
                                    <div class="left">
                                        <paper-checkbox style="font-size:16px; padding-top:25px;" id="da_sendemail" on-change="emailcheck">Send email on completion</paper-checkbox>
                                    </div>
                                    <div class="right">
                                        <paper-input always-float-label id="da_validemail" name="email" label="Email" value="" ></paper-input>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </table>
                    <div class="coadd-container">
                        <div class="left">
                            <paper-button raised class="indigo"  id="clearFormButton" on-tap="_clearForm">
                            <i class="fa fa-cogs"></i> &nbsp;  &nbsp;Clear Form
                            </paper-button>
                            </div>
                        <div class="right">
                            <paper-button raised  class="indigo"  id="da_submitJobButton" disabled on-tap="_submitJob">
                            <i class="fa fa-cogs"></i> &nbsp;  &nbsp;Submit Job
                            </paper-button>
                        </div>
                    </div>
                </div>
            </des-card>

            <des-positions-coadds-da id="desPositionsCoaddsDA"></des-positions-coadds-da>
            <des-positions-coords-da id="desPositionsCoordsDA"></des-positions-coords-da>

            <paper-toast class="toast-position" id="da_toast1coadd" text="Job has been submitted!" duration="5000"> </paper-toast>
            <paper-toast class="toast-position" id="da_toast2coadd" text="ERROR!. There was an error. Please try again" duration="5000"> </paper-toast>

            <paper-dialog class="size-position2" id="da_emaildialog" with-backdrop on-iron-overlay-opened="patchOverlay">
                <paper-card elevation="0">
                    <div class="card-content">
                        Please verify email address
                    </div>
                </paper-card>
            </paper-dialog>
        </section>
        <paper-fab class="fabHelp" icon="help" title="Help" on-tap="_seeHelp" style="float: right;"></paper-fab>

    </template>

</dom-module>

<script>

    Polymer({
        is: "des-data-analysis",
        properties: {
            file_name : {
                type : String,
                value : "Upload File"
            },
            enter_values : {
                type : String,
                value : "Enter Values"
            },

            submit_type : {
                type: String,
                value: "csvfile",
            },
            email: {
                type: String,
                values: "",
            },
            job_comment: {
                type : String,
                value : ""
            }
        },
        get file1(){
            return this.$.file1.files[0];
        },
        get file2(){
            return this.$.file2.files[0];
        },
        emailcheck: function(){
            var emailbox = document.getElementById("da_sendemail");
            var edialog = document.getElementById("da_emaildialog");
            document.getElementById("da_validemail").value=this.email;
            if (emailbox.checked == true){
                //edialog.open();
            }
            else
            {
                document.getElementById("da_validemail").value='';
            }
        },
        _fileChange1: function(){
            this.file_name = this.file1.name;
            console.log('File to read : ' + this.file_name );
            document.getElementById("da_submitJobButton").disabled=false;
            document.getElementById("da_enterCoadds").disabled=true;
            document.getElementById("da_enterCoords").disabled=true;
//            document.getElementById("da_uploadicon").style.display='none';
            document.getElementById("da_uploadiconcoadd").icon = "done";
            document.getElementById("da_uploadFileCoord").disabled=true;

            this.submit_type = 'coaddfile';
//            document.getElementById("filename").value = this.file_name;
        },
        _fileChange2: function(){
            this.file_name = this.file2.name;
            console.log('File to read : ' + this.file_name );
            document.getElementById("da_submitJobButton").disabled=false;
            document.getElementById("da_enterCoadds").disabled=true;
            document.getElementById("da_enterCoords").disabled=true;
//            document.getElementById("da_uploadicon").style.display='none';
            document.getElementById("da_uploadiconcoord").icon = "done";
            document.getElementById("da_uploadFileCoadd").disabled=true;

            this.submit_type = 'coordfile';
//            document.getElementById("filename").value = this.file_name;
        },
        clear: function(){
            document.getElementById("da_submitJobButton").disabled=true;
            document.getElementById("da_enterCoadds").disabled=false;
            document.getElementById("da_enterCoords").disabled=false;
            document.getElementById("da_uploadFileCoadd").disabled=false;
            document.getElementById("da_uploadFileCoord").disabled=false;
            document.getElementById("da_keyboardiconcoadd").style.display='inline-block';
            document.getElementById("da_keyboardiconcoord").style.display='inline-block';
            document.getElementById("da_radiusSlider").value="4.0";
            document.getElementById("da_radiusLabel").innerHTML="4.0";
            document.getElementById("da_wise").checked=false;
            document.getElementById("da_vhs").checked=false;
            document.getElementById("da_fluxwav").checked=false;
            document.getElementById("da_magwav").checked=false;
            document.getElementById("da_grri").checked=false;
            document.getElementById("da_gzzw1").checked=false;
            document.getElementById("da_spreadmag").checked=false;
            document.getElementById("da_sendemail").checked=false;
            document.getElementById("desPositionsCoaddsDA").clear();
            document.getElementById("desPositionsCoordsDA").clear();
            document.getElementById("da_validemail").value='';
            document.getElementById("da_validname").value='';
            document.getElementById("da_uploadiconcoadd").icon = "backup";
            document.getElementById("da_uploadiconcoord").icon = "backup";
            document.getElementById("da_keyboardiconcoadd").icon = "hardware:keyboard";
			document.getElementById("da_keyboardiconcoord").icon = "hardware:keyboard";
//            document.getElementById("coaddTag").selected="0";
            this.file_name = "Upload File";
            this.job_comment = "";
//            document.getElementById("jobcommentcoadds").value="";

            var upIcon1 = document.getElementById("da_uploadiconcoadd").style.display='inline-block';
            var upIcon2 = document.getElementById("da_uploadiconcoord").style.display='inline-block';
            this.enter_values = "Enter Values";
            //$('#dothis')[0].checked=false;
            this.$.file1.value = "";
            this.$.file2.value = "";
        },
		_countCoadds: function(coadds) {
			console.log(coadds);
		},
        _countCoords: function(coords) {
            console.log(coords);
        },
		_da_openCoadds: function(){
            var inputCoaddDialog = document.getElementById("da_inputCoaddsDialog");
            inputCoaddDialog.open();
            this.submit_type = 'manualCoadds';
        },
        _da_openCoords: function(){
            var inputCoordDialog = document.getElementById("da_inputCoordsDialog");
            inputCoordDialog.open();
            this.submit_type = 'manualCoords';
        },
        completeHandler: function(){
            console.log('YESSSSS');
            document.getElementById('desDataAnalysis').clear();
            document.querySelector('#da_toast1coadd').show();
            document.getElementById("getMyJobs").generateRequest();
        },
        errorHandler: function(){
            console.log('NOOOO');
            document.getElementById('desDataAnalysis').clear();
            document.querySelector('#da_toast2coadd').show();
        },
        _submitJob: function(event){
            var formdata = new FormData();
            formdata.append('csvfile1', this.$.file1.files[0]);
            formdata.append('csvfile2', this.$.file2.files[0]);
            formdata.append('da_radius', document.getElementById("da_radiusSlider").value);

            formdata.append('da_wise', document.getElementById("da_wise").checked);
            formdata.append('da_vhs', document.getElementById("da_vhs").checked);
            
            formdata.append('da_fluxwav', document.getElementById("da_fluxwav").checked);
            formdata.append('da_magwav', document.getElementById("da_magwav").checked);
            formdata.append('da_grri', document.getElementById("da_grri").checked);
            formdata.append('da_gzzw1', document.getElementById("da_gzzw1").checked);
            formdata.append('da_spreadmag', document.getElementById("da_spreadmag").checked);
            
            formdata.append('da_send_email', document.getElementById("da_sendemail").checked);
            formdata.append('da_email', document.getElementById("da_validemail").value);
            formdata.append('da_name', document.getElementById("da_validname").value);
            formdata.append('da_submit_type', this.submit_type);
            formdata.append('da_coadds',document.getElementById("da_enteredCoadds").value);
            formdata.append('da_coords',document.getElementById("da_enteredCoords").value);

            var fluxwav = document.getElementById("da_fluxwav").checked;
            var magwav = document.getElementById("da_magwav").checked;
            var grri = document.getElementById("da_grri").checked;
            var gzzw1 = document.getElementById("da_gzzw1").checked;
            var spread = document.getElementById("da_spreadmag").checked;
            if (fluxwav == false && magwav == false && grri == false && gzzw1 == false && spread == false){
                document.getElementById('desDataAnalysis').errorHandler();
            }
            else{
                $.ajax({
                    url: '/easyweb/dr1_vistools/',
                    type: 'POST',
                    //beforeSend: this.beforeSendHandler,
                    success: this.completeHandler,
                    error: this.errorHandler,
                    data: formdata,
                    cache: false,
                    contentType: false,
                    processData: false
                });
            }
        },
        _clearForm: function(){
            console.log('clear Form');
            desDataAnalysis=document.getElementById('desDataAnalysis');
            desDataAnalysis.clear();
        },
        patchOverlay: function (e) {
            if (e.target.withBackdrop) {
                e.target.parentNode.insertBefore(e.target.backdropElement, e.target);
            }
        },
        _seeHelp: function(e){
            e.preventDefault();
            document.getElementById('jobHelpDataAnalysis').open();
        },


        _nextPage: function() {
            var crs = document.getElementById("da-coadd-crs");
            crs.goToNextPage();
        },

        _prevPage: function() {
            var crs = document.getElementById("da-coadd-crs");
            crs.goToPrevPage();
        },
        _gobackdialog: function(event){
            document.getElementById('jobHelpDataAnalysis').close();
        },

    });



</script>
